<domain type="kvm">
  <name>{{ __vm_spec.name }}</name>
  <uuid>{{ __vm_spec.uuid }}</uuid>
  <os>
    <type>hvm</type>
    <boot dev="hd"/>
  </os>
  <vcpu>1</vcpu>
  <memory unit="{{ __vm_spec.memory.unit }}">{{ __vm_spec.memory.size }}</memory>
  <cpu mode="host-model">
    <topology sockets="{{ __vm_spec.sockets
      }}" cores="{{ __vm_spec.cores_per_socket
      }}" threads="{{ __vm_spec.threads_per_core }}"/>
  </cpu>
  <on_poweroff>destroy</on_poweroff>
  <on_reboot>restart</on_reboot>
  <on_crash>restart</on_crash>
  <on_lockfailure>poweroff</on_lockfailure>
  <pm>
    <suspend-to-disk enabled="no"/>
    <suspend-to-mem enabled="no"/>
  </pm>
  <features>
    <acpi/>
    <apic/>
  </features>
  <clock offset="utc">
    <timer name="rtc" tickpolicy="catchup" track="guest"/>
  </clock>
  <devices>
    <emulator>{{ __vm_spec.emulator }}</emulator>
    <disk type="file" device="disk" snapshot="no">
      <driver name="qemu" type="qcow2"/>
      <source file="{{ __vm_spec.image }}"/>
      <target dev="vda" bus="virtio"/>
    </disk>
    <disk type="file" device="cdrom">
      <driver name="qemu" type="raw"/>
      <source file="{{ __vm_spec.cloud_metadata_image }}"/>
      <target dev="cdrom" bus="scsi"/>
      <readonly/>
    </disk>
    <interface type="network">
      <source network="default"/>
      <mac address="{{ __vm_spec.network.mac }}"/>
      <model type="virtio"/>
    </interface>
    <interface type="user">
      <backend type="passt" logFile="{{ __vm_spec.network.passt_log }}"/>
      <portForward proto="tcp">
        <range start="{{ __vm_spec.network.port }}" to="22"/>
      </portForward>
    </interface>
    <serial type="pty">
      <source path="/dev/pts/2"/>
      <target port="0"/>
      <log file="{{ __vm_spec.guest_log }}" append="off"/>
    </serial>
    <rng model="virtio">
      <backend model="random">/dev/urandom</backend>
    </rng>
  </devices>
</domain>
